!function(){"use strict";angular.module("ngD3matrix",[]).directive("adjacencyMatrix",function($parse,$window){return{restrict:"EA",scope:{data:"=",labelMap:"=",jsonPath:"@",width:"@",height:"@",id:"@",colorRange:"@"},template:"<svg></svg>",link:function(scope,elem,attrs){var margin={top:60,right:40,bottom:40,left:60},width=parseInt(scope.width),height=parseInt(scope.height),d3=$window.d3,x=d3.scale.ordinal().rangeBands([0,width]),cellSize=12,getOpacity=d3.scale.linear().domain([0,1]).clamp(!0),getColor=d3.scale.linear().domain([1,10]).interpolate(d3.interpolateHcl).range(scope.colorRange.split(",")),rawSvg=elem.find("svg"),svg=d3.select(rawSvg[0]).attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).style("margin-left",margin.left+"px").append("g").attr("transform","translate("+margin.left+","+margin.top+")"),setRow=function(row){d3.select(this).selectAll(".cell").data(row).enter().append("rect").attr("class","cell").attr("x",function(d){return x(d.x)}).attr("width",cellSize).attr("height",cellSize).style("fill-opacity",function(d){return getOpacity(d.z)}).style("fill",function(d){var colorObj;return colorObj=getColor(d.c)}).on("mouseover",mouseover).on("mouseout",mouseout)},mouseover=function(p){console.log(p),d3.selectAll(".row text").classed("active",function(d,i){return i==p.y}),d3.selectAll(".column text").classed("active",function(d,i){return i==p.x})},mouseout=function(){d3.selectAll("text").classed("active",!1)},render=function(matrixJson){svg.selectAll("*").remove();var matrix=[],nodes=matrixJson.nodes,n=nodes.length;matrixJson.links;nodes.forEach(function(node,i){node.count=0,matrix[i]=d3.range(n).map(function(j){return{x:j,y:i,z:0,c:0}})}),cellSize=width/n,matrixJson.links.forEach(function(link){matrix[link.source][link.target].z=link.value,matrix[link.source][link.target].c=nodes[link.source].rank,nodes[link.source].rank&&link.value>nodes[link.source].count&&(nodes[link.source].count=link.value)});var orders={name:d3.range(n).sort(function(a,b){return d3.ascending(nodes[a].name,nodes[b].name)}),count:d3.range(n).sort(function(a,b){return nodes[b].count-nodes[a].count}),rank:d3.range(n).sort(function(a,b){return nodes[b].rank-nodes[a].rank})};x.domain(orders.count),svg.selectAll(".row").data(matrix).enter().append("g").attr("class","row").attr("transform",function(d,i){return"translate(0,"+x(i)+")"}).each(setRow).append("text").attr("x",-6).attr("y",function(d,i){return 0}).attr("dy",".9em").attr("text-anchor","end").text(function(d,i){return nodes[i].name}),svg.selectAll(".column").data(matrix).enter().append("g").attr("class","column").attr("transform",function(d,i){return"translate("+x(i)+")rotate(-90)"}).append("text").attr("x",6).attr("dy",".9em").attr("text-anchor","start").text(function(d,i){return nodes[i].name})};scope.jsonPath?d3.json(scope.jsonPath,function(error,json){return error?void console.error(error):void render(json)}):scope.$watch("data",function(newVals,oldVals){if(newVals)return render(newVals)},!0),d3.select(self.frameElement).style("height",height+"px")}}})}();